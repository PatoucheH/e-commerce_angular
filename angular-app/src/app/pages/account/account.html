<!-- PAGE D'AUTHENTIFICATION -->
<div
  *ngIf="isAuthMode"
  class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8"
>
  <div class="sm:mx-auto sm:w-full sm:max-w-md">
    <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
      {{ isLoginMode ? "Connexion" : "Créer un compte" }}
    </h2>
    <p class="mt-2 text-center text-sm text-gray-600">
      {{
        isLoginMode
          ? "Connectez-vous à votre compte"
          : "Rejoignez notre communauté"
      }}
    </p>
  </div>

  <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
    <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
      <!-- Onglets Login / Register -->
      <div class="flex mb-8">
        <button
          (click)="switchAuthMode('login')"
          class="flex-1 py-2 px-4 text-sm font-medium text-center border-b-2 transition-colors duration-200"
          [class.border-blue-500]="isLoginMode"
          [class.text-blue-600]="isLoginMode"
          [class.border-gray-300]="!isLoginMode"
          [class.text-gray-500]="!isLoginMode"
        >
          Se connecter
        </button>
        <button
          (click)="switchAuthMode('register')"
          class="flex-1 py-2 px-4 text-sm font-medium text-center border-b-2 transition-colors duration-200"
          [class.border-blue-500]="isRegisterMode"
          [class.text-blue-600]="isRegisterMode"
          [class.border-gray-300]="!isRegisterMode"
          [class.text-gray-500]="!isRegisterMode"
        >
          S'inscrire
        </button>
      </div>

      <!-- Messages d'erreur et de succès -->
      <div
        *ngIf="error"
        class="mb-4 p-4 bg-red-50 border border-red-300 rounded-md"
      >
        <p class="text-sm text-red-700">{{ error }}</p>
      </div>

      <div
        *ngIf="successMessage"
        class="mb-4 p-4 bg-green-50 border border-green-300 rounded-md"
      >
        <p class="text-sm text-green-700">{{ successMessage }}</p>
      </div>

      <!-- Formulaire d'authentification -->
      <form (ngSubmit)="onAuthSubmit()" class="space-y-6">
        <div *ngIf="isRegisterMode" class="grid grid-cols-2 gap-4">
          <div>
            <label
              for="firstName"
              class="block text-sm font-medium text-gray-700"
            >
              Prénom *
            </label>
            <input
              id="firstName"
              name="firstName"
              type="text"
              [(ngModel)]="formData.firstName"
              required
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="Prénom"
            />
          </div>
          <div>
            <label
              for="lastName"
              class="block text-sm font-medium text-gray-700"
            >
              Nom *
            </label>
            <input
              id="lastName"
              name="lastName"
              type="text"
              [(ngModel)]="formData.lastName"
              required
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="Nom"
            />
          </div>
        </div>

        <div>
          <label for="email" class="block text-sm font-medium text-gray-700">
            Adresse email *
          </label>
          <input
            id="email"
            name="email"
            type="email"
            [(ngModel)]="formData.email"
            required
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="exemple@email.com"
          />
        </div>

        <div>
          <label for="password" class="block text-sm font-medium text-gray-700">
            Mot de passe *
          </label>
          <input
            id="password"
            name="password"
            type="password"
            [(ngModel)]="formData.password"
            required
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="••••••••"
          />
        </div>

        <div>
          <button
            type="submit"
            [disabled]="loading"
            class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
            [class.bg-blue-600]="!loading"
            [class.hover:bg-blue-700]="!loading"
            [class.bg-gray-400]="loading"
            [class.cursor-not-allowed]="loading"
          >
            <svg
              *ngIf="loading"
              class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>

            {{
              loading
                ? "Chargement..."
                : isLoginMode
                ? "Se connecter"
                : "Créer le compte"
            }}
          </button>
        </div>

        <div class="text-center mt-4">
          <button
            type="button"
            (click)="switchAuthMode(isLoginMode ? 'register' : 'login')"
            class="text-blue-600 hover:text-blue-500 text-sm font-medium"
          >
            {{
              isLoginMode
                ? "Pas encore de compte ? S'inscrire"
                : "Déjà un compte ? Se connecter"
            }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- PAGE DE PROFIL UTILISATEUR -->
<div
  *ngIf="isProfileMode"
  class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"
>
  <div class="max-w-4xl mx-auto">
    <!-- En-tête du profil -->
    <div class="bg-white shadow rounded-lg mb-8">
      <div class="px-6 py-8">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Mon Compte</h1>
            <p class="mt-2 text-gray-600">
              Bienvenue, {{ user?.firstName }} {{ user?.lastName }}
            </p>
          </div>
          <button
            (click)="logout()"
            class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors duration-200"
          >
            Se déconnecter
          </button>
        </div>
      </div>

      <!-- Section Commandes -->
      <div class="xl:col-span-1 bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">Mes Commandes</h2>
        </div>

        <div class="p-6">
          <!-- Message d'erreur -->
          <div
            *ngIf="ordersError"
            class="mb-4 p-4 bg-red-50 border border-red-300 rounded-md"
          >
            <p class="text-sm text-red-700">{{ ordersError }}</p>
          </div>

          <!-- Chargement -->
          <div *ngIf="ordersLoading" class="flex justify-center py-8">
            <svg
              class="animate-spin h-8 w-8 text-blue-600"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
          </div>

          <!-- Liste des commandes -->
          <div *ngIf="!ordersLoading && orders.length > 0" class="space-y-4">
            <div
              *ngFor="let order of orders"
              class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200"
            >
              <!-- En-tête de la commande -->
              <div class="flex justify-between items-start mb-3">
                <div>
                  <p class="font-semibold text-gray-900">
                    Commande #{{ order.id }}
                  </p>
                  <p class="text-sm text-gray-600">
                    {{ formatDate(order.createdAt) }}
                  </p>
                </div>
                <div class="text-right">
                  <span
                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                    [class]="getStatusColor(order.status)"
                  >
                    {{ getStatusLabel(order.status) }}
                  </span>
                  <p class="text-lg font-semibold text-gray-900 mt-1">
                    {{ order.total }}€
                  </p>
                </div>
              </div>

              <!-- Adresse de livraison -->
              <div class="mb-3">
                <p class="text-sm text-gray-600">
                  <span class="font-medium">Livraison :</span>
                  {{ order.shippingAddress }}
                </p>
              </div>

              <!-- Bouton pour voir les détails -->
              <button
                (click)="viewOrderDetails(order)"
                class="w-full text-left px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded border border-blue-200 transition-colors duration-200"
              >
                {{
                  selectedOrder?.id === order.id
                    ? "Masquer les détails"
                    : "Voir les détails"
                }}
              </button>

              <!-- Détails de la commande (expandable) -->
              <div
                *ngIf="selectedOrder?.id === order.id"
                class="mt-4 pt-4 border-t border-gray-200"
              >
                <h4 class="font-medium text-gray-900 mb-3">
                  Articles commandés :
                </h4>
                <div class="space-y-2">
                  <div
                    *ngFor="let item of order.items"
                    class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded"
                  >
                    <div>
                      <p class="font-medium text-gray-900">
                        {{ item.productName || "Produit #" + item.productId }}
                      </p>
                      <p class="text-sm text-gray-600">
                        Quantité : {{ item.quantity }}
                      </p>
                    </div>
                    <div class="text-right">
                      <p class="font-semibold text-gray-900">
                        {{ item.unitPrice }}€
                      </p>
                      <p class="text-sm text-gray-600">
                        Total : {{ item.quantity * item.unitPrice }}€
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Aucune commande -->
          <div
            *ngIf="!ordersLoading && orders.length === 0"
            class="text-center py-8"
          >
            <div class="text-gray-400 mb-4">
              <svg
                class="mx-auto h-12 w-12"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
                />
              </svg>
            </div>
            <p class="text-gray-500 text-lg font-medium">Aucune commande</p>
            <p class="text-gray-400 mt-1">
              Vous n'avez passé aucune commande pour le moment
            </p>
            <a
              routerLink="/products"
              class="inline-block mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors duration-200"
            >
              Découvrir nos produits
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
      <!-- Section Informations personnelles -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">
            Informations personnelles
          </h2>
        </div>

        <div class="p-6">
          <!-- Messages -->
          <div
            *ngIf="profileError"
            class="mb-4 p-4 bg-red-50 border border-red-300 rounded-md"
          >
            <p class="text-sm text-red-700">{{ profileError }}</p>
          </div>

          <div
            *ngIf="profileSuccess"
            class="mb-4 p-4 bg-green-50 border border-green-300 rounded-md"
          >
            <p class="text-sm text-green-700">{{ profileSuccess }}</p>
          </div>

          <form (ngSubmit)="onProfileUpdate()" class="space-y-6">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label
                  for="profileFirstName"
                  class="block text-sm font-medium text-gray-700"
                >
                  Prénom
                </label>
                <input
                  id="profileFirstName"
                  name="profileFirstName"
                  type="text"
                  [(ngModel)]="profileData.firstName"
                  required
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>

              <div>
                <label
                  for="profileLastName"
                  class="block text-sm font-medium text-gray-700"
                >
                  Nom
                </label>
                <input
                  id="profileLastName"
                  name="profileLastName"
                  type="text"
                  [(ngModel)]="profileData.lastName"
                  required
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
            </div>

            <div>
              <label
                for="profileEmail"
                class="block text-sm font-medium text-gray-700"
              >
                Adresse email
              </label>
              <input
                id="profileEmail"
                name="profileEmail"
                type="email"
                [(ngModel)]="profileData.email"
                required
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              />
            </div>

            <div>
              <button
                type="submit"
                [disabled]="updateLoading"
                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
                [class.bg-blue-600]="!updateLoading"
                [class.hover:bg-blue-700]="!updateLoading"
                [class.bg-gray-400]="updateLoading"
                [class.cursor-not-allowed]="updateLoading"
              >
                <svg
                  *ngIf="updateLoading"
                  class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                  ></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
                {{ updateLoading ? "Mise à jour..." : "Mettre à jour" }}
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Section Changement de mot de passe -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">
            Changer le mot de passe
          </h2>
        </div>

        <div class="p-6">
          <!-- Messages -->
          <div
            *ngIf="passwordError"
            class="mb-4 p-4 bg-red-50 border border-red-300 rounded-md"
          >
            <p class="text-sm text-red-700">{{ passwordError }}</p>
          </div>

          <div
            *ngIf="passwordSuccess"
            class="mb-4 p-4 bg-green-50 border border-green-300 rounded-md"
          >
            <p class="text-sm text-green-700">{{ passwordSuccess }}</p>
          </div>

          <form (ngSubmit)="onPasswordChange()" class="space-y-6">
            <div>
              <label
                for="currentPassword"
                class="block text-sm font-medium text-gray-700"
              >
                Mot de passe actuel
              </label>
              <input
                id="currentPassword"
                name="currentPassword"
                type="password"
                [(ngModel)]="passwordData.currentPassword"
                required
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="••••••••"
              />
            </div>

            <div>
              <label
                for="newPassword"
                class="block text-sm font-medium text-gray-700"
              >
                Nouveau mot de passe
              </label>
              <input
                id="newPassword"
                name="newPassword"
                type="password"
                [(ngModel)]="passwordData.newPassword"
                required
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="••••••••"
              />
            </div>

            <div>
              <label
                for="confirmPassword"
                class="block text-sm font-medium text-gray-700"
              >
                Confirmer le nouveau mot de passe
              </label>
              <input
                id="confirmPassword"
                name="confirmPassword"
                type="password"
                [(ngModel)]="passwordData.confirmPassword"
                required
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="••••••••"
              />
            </div>

            <div>
              <button
                type="submit"
                [disabled]="passwordLoading"
                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
                [class.bg-blue-600]="!passwordLoading"
                [class.hover:bg-blue-700]="!passwordLoading"
                [class.bg-gray-400]="passwordLoading"
                [class.cursor-not-allowed]="passwordLoading"
              >
                <svg
                  *ngIf="passwordLoading"
                  class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                  ></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
                {{
                  passwordLoading ? "Changement..." : "Changer le mot de passe"
                }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
